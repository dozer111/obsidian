---
tags:
 DB
 PostgreSQL
 explain
---

00 => [[002 PG explain]]

оригінальна стаття:  https://www.depesz.com/2013/04/27/explaining-the-unexplainable-part-2/
переклад habr: https://habr.com/ru/articles/276973/
стаття про те, як взагалі працює запит в postgres: https://habr.com/ru/articles/304258/

---

отож, запит складається з операцій. Операції являють собою дерево, в якому кожна операція може бути основною, а може бути лише частиною чогось іншого

базові операції отримання даних:
1. seq scan - почергове проходження по таблиці oneByOne
2. index scan - знаходим по індексу значення в таблиці, йдем в таблицю і вибираємо дані
3. index only scan - знаходимо все що потрібно в індексі, в таблицю вже не йдемо
4. Bitmap Index Scan - створюється бітова карта сторінок на яких можуть бути дані, далі почергово проходимось по сторінках і дістаємо дані


# Flashcards

які є типи операцій в query plan
? 
1. seq scan
2. index scan
3. index only scan
4. bitmap index scan

що такe `seq scan`
? 
це тип вибірки(операція), коли ми по-черзі проходимось по таблиці і її значенням, і таким чином перебираємо всю таблицю(або скільки треба) в пошуках даних

що такe `index scan`
?
це тип вибірки(операція), коли ми для отримання даних спочатку йдемо в індекс, і з'ясовуємо які саме записи нам треба. Далі проходимось по таблиці і власне точково вибираємо їх

що такe `index only scan`
?
це тип вибірки(операція), коли ми в індексі маємо всі дані, які необхідно видати в результат. Тому ми фільтруємо дані в індексі, і не йдучи в таблицю зразу віддаємо дані назад.

що такe `bitmap index scan`
?
це тип вибірки(операція), коли ми для того щоб вибрати дані спочатку маємо зробити бітову карту сторінок де позначаємо на якій сторінці теоретично є потрібні дані, а на якій - ні. Далі - проходимось по сторінкам і вибираємо потрібну інфу по принципу `seq scan`


що значить, коли у нас `index scan`
?
значить, що ми шукаємо по індексу, але значення які ми просим відсутні в самому індексі. Тому нам крім пошуку ще треба сходить у власне таблицю і достати недостающі дані

що значить, коли у нас `index only scan`
?
значить, що ми шукаємо по індексу, і ВСІ значення які треба видати назад у нас ВЖЕ є. Тобто ми все що треба вже знаємо, тому в таблицю не ходимо, що на порядок швидше за `index scan`

що краще: `index scan` чи `index only scan`
?
порівняння теплого і синього. `index only scan` - частковий і найкращий випадок. `index scan` - теж ок

що краще: `index scan` чи `bitmap index scan`
?
порівняння теплого і синього. `index scan` зазвичай використовується на відносно простих запитах.  `bitmap index scan` використовується там, де база не може просто взяти, і в одну ітерацію пройтись по індексу і з'ясувати де саме потрібні дані(наприклад `select * from tbl where id > 5_000 || id < 700`).
Звісно що index scan більш наглядний, але і в бітмаповому нічого поганого немає

як працює `index scan`
?
- зайшли в індекс
- знайшли де є необхідні дані
- пішли в таблицю і точково дістали

як працює `index only scan`
?
- зайшли в індекс
- знайшли де є необхідні дані
- вернули

як працює `bitmap index scan`
?
- створення бітової карти сторінок(bitmap index scan)
- послідовне проходження по вказаним сторінкам таблиці